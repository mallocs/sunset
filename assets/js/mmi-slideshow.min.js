/*! mmi-slideshow - v0.0.0 - 2015-01-28
* https://github.com/mallocs/mmi-slideshow
* Copyright (c) 2015 Marcus Ulrich; Licensed MIT */
!function(a){a.widget("mmi.slideshow",{version:"0.0.0",CN:{navigation:"mmi-navigation",footer:"mmi-footer",previous:"mmi-previous",previousIcon:"mmi-icon-previous",next:"mmi-next",nextIcon:"mmi-icon-next",pagination:"mmi-pagination",paginationCircle:"mmi-circle",paginationThumbnail:"mmi-thumbnail",caption:"mmi-caption",selected:"mmi-selected",disabled:"mmi-disabled",dark:"mmi-dark",inside:"mmi-inside",responsive:"mmi-responsive"},options:{carouselSel:".mmi-slideshow ul",slideSel:".mmi-slideshow li",startSlide:1,buffer:2,width:!0,height:!0,transition:"scroll",transitionSpeed:600,transitionOptions:{},navigation:!0,previousText:!1,nextText:!1,loop:!0,captions:!0,autoHideNavigation:!1,autoHideFooter:!1,dark:!1,inside:!1,insideNavigation:!1,responsive:!1,pagination:!0,sprite:!1,spriteWidth:!1,spriteHeight:!1},_create:function(){this.options=a.extend({},this.options,a(this.element).data()),this.carousel=this.element.children(this.options.carouselSel),this.slides=this.carousel.children(this.options.slideSel),this.currentSlideNumber=parseInt(this.options.startSlide,10),this.count=this.slides.length,this._createWrapper(),this.options.navigation&&this._createNavigation(),this._createFooter(),this.options.captions&&this._createCaption(),this.options.pagination&&this._createPagination(),this.setCurrentSlide(this.currentSlideNumber)},_createWrapper:function(){this.carouselWrapper=this.carousel.wrap('<div style="position:relative; overflow: hidden;"></div>').parent(),this.wrapper=this.carouselWrapper.wrap('<div style="position:relative;"></div>').parent(),this._on(this.wrapper,{mouseenter:"_slideshowMouseInEvent",mouseout:"_slideshowMouseOutEvent"})},_createFooter:function(){if(this.$footer=a("<div>",{"class":this.CN.footer}),this.options.autoHideFooter){var b=this;this.$footer.css({display:"none"}),a(this.element).hover(function(){b.$footer.show({duration:300,effect:"fade"})},function(){b.$footer.hide({duration:300,effect:"fade"})})}this.options.inside?(this.$footer.addClass(this.CN.inside),this.$footer.addClass(this.CN.dark)):this.options.dark&&this.$footer.addClass(this.CN.dark),this.element.append(this.$footer)},_slideshowMouseInEvent:function(){},_slideshowMouseOutEvent:function(){},_createNavigation:function(){if(this.$previous=a('<span data-slides="previous"></span>'),this.$previous.addClass(this.CN.navigation).addClass(this.CN.previous),this.options.previousText?this.$previous.html(this.options.previousText):this.$previous.addClass(this.CN.previousIcon),this._on(this.$previous,{click:"previous"}),this.$next=a('<span data-slides="next"></span>'),this.$next.addClass(this.CN.navigation).addClass(this.CN.next),this.options.nextText?this.$next.html(this.options.nextText):this.$next.addClass(this.CN.nextIcon),this._on(this.$next,{click:"next"}),this.options.autoHideNavigation){var b=this;this.$next.css({display:"none"}),this.$previous.css({display:"none"}),a(this.element).hover(function(){b.showNavigation()},function(){b.hideNavigation()})}(this.options.inside||this.options.insideNavigation)&&(this.$next.addClass(this.CN.inside),this.$previous.addClass(this.CN.inside)),(this.options.dark||this.options.inside||this.options.insideNavigation)&&(this.$next.addClass(this.CN.dark),this.$previous.addClass(this.CN.dark)),this.wrapper.append(this.$next,this.$previous)},_createCaption:function(){this.$caption=a("<div>",{"class":this.CN.caption}),this.$footer.append(this.$caption)},_createPagination:function(){this.$pagination=a("<ul>",{"class":this.CN.pagination});for(var b,c=1,d=this.count;d>=c;c++){if("numbers"===this.options.pagination)b=a('<a href="#" data-slide="'+c+'">'+c+"</a>");else if("sprite"===this.options.pagination&&this.options.sprite){var e=this.options.spriteWidth?parseInt(this.options.spriteWidth,10):40,f=this.options.spriteHeight?parseInt(this.options.spriteHeight,10):40;b=a('<a href="#" data-slide="'+c+'"></a>').addClass(this.CN.paginationThumbnail),b.css({width:e+"px",height:f+"px",background:'url("'+this.options.sprite+'") no-repeat scroll 0 '+-f*(c-1)+"px transparent"})}else b=a('<a href="#" data-slide="'+c+'"></a>').addClass(this.CN.paginationCircle);var g=a("<li></li>");g[0].appendChild(b[0]),this.$pagination.append(g)}this._on(this.$pagination,{"click a":"_page"}),this.$footer.append(this.$pagination),this.pages=this.$pagination.children(this.count)},_getSlideFromNumber:function(b){return a(this.slides[parseInt(b,10)-1])},_page:function(b){b.preventDefault();var c=a(b.target).data("slide");this.setCurrentSlide(c)},_setPage:function(b){if("undefined"!=typeof this.pages){var c=a(this.pages[parseInt(b,10)-1]);this.pages.not(c).find("a").removeClass(this.CN.selected),c.find("a").addClass(this.CN.selected)}},next:function(){var a=this.currentSlideNumber+1;if(a>this.count){if(!this.options.loop)return;a=1}this.setCurrentSlide(a)},previous:function(){var a=this.currentSlideNumber-1;if(1>a){if(!this.options.loop)return;a=this.count}this.setCurrentSlide(a)},showNavigation:function(a){a=1===arguments.length?parseInt(a,10):200,this.$next.show("fade",a),this.$previous.show("fade",a)},hideNavigation:function(a){a=1===arguments.length?parseInt(a,10):200,this.$next.hide("fade",a),this.$previous.hide("fade",a)},setCaption:function(a){a="undefined"!=typeof a?a:"&nbsp;","undefined"!=typeof this.$caption&&this.$caption.html("<p>"+a+"</p>")},showCaption:function(){this.$caption.show()},hideCaption:function(){this.$caption.hide()},setCurrentSlide:function(b){var c=this._getSlideFromNumber(b);this._loadSlide(c);var d=a(c.children()[0]),e=parseInt(this.options.transitionSpeed,10),f=this.options.transitionOptions,g=this.options.transition+"";if("undefined"==typeof this.currentSlide)c.show(),this.carousel.find("li").not(c).css({display:"none"});else if("scroll"===g){var h;this.carouselWrapper.is(":animated")?(this.carouselWrapper.stop(),e=this.transitionSpeed=this.transitionSpeed/2||e/2,h=this.currentTarget):(this.carousel.find("li").css({"float":"left",position:"static",display:"list-item"}),this.carousel.css({minWidth:"10000em"})),this.carouselWrapper.animate({scrollLeft:c.position().left+this.carouselWrapper.scrollLeft()},e)}else this.carousel.find("li").not(this.currentSlide).css({display:"none",position:"static",bottom:"",left:"",width:""}),c.show("fade",f,e),this.currentSlide.css({position:"absolute",bottom:0,left:0,width:this.currentSlide.width()+"px"}),this.currentSlide.hide(g,f,e);this._setDimensions(c,this.options.width,this.options.height),this.setCaption(d.data("caption")),this._setPage(b),this.currentSlide=c,this.currentSlideNumber=b,this._bufferSlides(parseInt(this.options.buffer,10))},_setDimensions:function(b,c,d){var e=this;if(b=b||this.currentSlide,b.find("img").length&&b.find("img")[0].complete!==!0)return void b.find("img").load(function(){e._setDimensions(b,c,d)});if(c=c===!0?b.width():c,"undefined"!=typeof c&&(this.wrapper.width(c),this.$footer.width(c)),d=d===!0?b.height():d,3===arguments.length&&"undefined"!=typeof d&&this.carouselWrapper.height(d),this.options.responsive){var f=this.wrapper.width()/this.carouselWrapper.height(),g=b.find("img")[0],h=a(g).width()/a(g).height();h>=f?(a(g).css({width:"100%"}),this.carouselWrapper.height(a(g).height())):a(g).css({position:"static",height:this.carouselWrapper.height()+"px",width:"auto"})}},_bufferSlides:function(b){var c=this;this.slides.slice(this.currentSlideNumber,this.currentSlideNumber+b).each(function(b,d){c._loadSlide.call(c,a(d))})},_loadSlide:function(b){if(void 0===b.attr("slideIsLoaded")&&b.attr("slideIsLoaded")!==!0){var c=a(b.children()[0]);c.is("img")&&this._loadImage(c),b.attr("slideIsLoaded",!0)}},_loadImage:function(a){void 0===a.attr("src")&&void 0!==a.data("src")&&a.attr("src",a.data("src"))},_setOption:function(a,b){"navigation"===a&&(b?this.showNavigation():this.hideNavigation()),"captions"===a&&(b?this.showCaption():this.hideCaption()),"buffer"===a&&this._bufferSlides(parseInt(b,10)),"nextText"===a&&(b?(this.$next.removeClass(this.CN.nextIcon),this.$next.html(b)):(this.$next.html(""),this.$next.addClass(this.CN.nextIcon))),"previousText"===a&&(b?(this.$previous.removeClass(this.CN.previousIcon),this.$previous.html(b)):(this.$previous.html(""),this.$previous.addClass(this.CN.previousIcon))),this._super(a,b)},_destroy:function(){}})}(jQuery);